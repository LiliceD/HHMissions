{% extends 'layout-large.html.twig' %}


{% block header_h3 %}
  Liste des fiches mission
{% endblock %}

{% block header_button %}
  {# new mission button only visible for gla (and admin) #}
  {% if is_granted('ROLE_GLA') %}
    <a href="{{ path('app_mission_new') }}" class="btn btn-success">
      <i class="fas fa-plus"></i>
      Créer une fiche mission
    </a>
  {% endif %}
{% endblock %}


{% block content %}
  
  <table class="table table-hover">

    <thead class="thead-light">
      <tr>
        <th scope="col">N°</th>
        <th scope="col">Date demande</th>
        <th scope="col">Provenance GLA</th>
        <th scope="col">Adresse</th>
        <th scope="col">Description mission</th>
        <th scope="col">Statut</th>
        <th></th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      {% for mission in missions %}
        <tr id="mission-{{ mission.id }}">
          <td>{{ mission.id }}</td>
          <th scope="row">{{ mission.dateCreated|date('d/m/y') }}</th>
          <td>{{ mission.gla }}</td>
          {# address #}
          <td>
            {% if mission.accomodation.name %}
              {{ mission.accomodation.name }} - 
            {% endif %}
            {{ mission.accomodation.street }}
            <br>
            {{ mission.accomodation.postalCode }} {{ mission.accomodation.city }}
          </td>
          <td><div class="text-ellipsis">{{ mission.description }}</div></td>
          <td>{{ mission.status }}</td>
          {# view button #}
          <td>
            <a href="{{ path('app_mission_view', {'id': mission.id}) }}" title="Voir la FM {{ mission.id }}" class="btn btn-sm btn-primary">
              <i class="fas fa-eye"></i>
              Voir
            </a>
          </td>
          {# edit button only visible for admin, mission's gla or mission's volunteer #}
          {% if is_granted('ROLE_ADMIN') or (is_granted('ROLE_GLA') and mission.gla == app.user.name) or (is_granted('ROLE_VOLUNTEER') and mission.volunteer == app.user.name) %}
            <td>
              <a href="{{ path('app_mission_edit', {'id': mission.id}) }}" title="Modifier la FM {{ mission.id }}" class="btn btn-sm btn-outline-primary">
                <i class="fas fa-edit"></i>
                Modifier
              </a>
            </td>
          {% endif %}
        </tr>
      {% endfor %}
    </tbody>

  </table>
  
{% endblock %}
